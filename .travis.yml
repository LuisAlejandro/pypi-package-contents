sudo: required
services: docker
dist: bionic
group: edge
language: python
env:
    global:
        # Docker Hub username ${DH_USERNAME}
        - DH_USERNAME="luisalejandro"
        # Docker Hub password ${DH_PASSWORD}
        - secure: "aDh2Y8v2/WAq0pvFJ3hn6Cm0j8Hf3XtuZvS5WdmMyIingrt1E2/EqKy15pACzjCJfY8jZ4a6rbJcWug16HH5EL9qFrdMru6ci0umwa2NOZaqPSBVE8RHSx5VREDKItu61pZG7UQMfb43zDLHnzOpL1U3ZYRLeb/TxHbzKaiaG/jQRf8n1WvGX+c9Ol1fDbd/Z7KcQnSE1uvuQHb5NDVvVQmCNICMAnssGsTmsP9R48zqMOw2eFV36Cpj6pjalyQZ9Y72RIewqea6RS/yQE1+mEePrSLsHEkVtgIFxb7cQ+XDbVWpBA4BBVp6xZx5wZmOBxUt9cAcrKIANdEAY/yiN+POJCCfhMA82S3U5kZZgJtr2NBTx/hG8wR9TW8uKRNqWHngY61RILklMc82DZRnKOfyLZ8SUsMmNBFlzZGzbu1fXLyX9QaMuCRBaZ4frgwHO964LQtRgUlnR/SIS6RwXmGtngnbRbtokFXib7I4qJHzhpOOvDU35wZnlPa39CZl8MRmRGzfGOH5diolzcPY59Hib2/sjBoLbGDYcW0dkGisa1LSUnBMRBQDYW3I1z6EWDzvgWLIMRIIJxaBR/oaabTK+hKgwPiCbTTXkSO8x4Y4zwIibTwSlVI/KegLhuGl0k5f8jUYu23wEjP8qxDhjiw7TAgmMqz6H3LIoyEOPXU="
jobs:
    include:
        - python: "3.5"
          env: TOXENV=py35
        - python: "3.6"
          env: TOXENV=py36
        - python: "3.7"
          env: TOXENV=py37
        - python: "3.8"
          env: TOXENV=py38
        - python: "pypy3"
          env: TOXENV=pypy3
install:
    - pip install -r requirements-dev.txt
script:
    - tox -e ${TOXENV}
    - docker login --username ${DH_USERNAME} --password ${DH_PASSWORD}
    - |
        if [ "${TOXENV}" == "pypy3" ]; then
          docker run -v ${PWD}:${PWD} -w ${PWD} \
              pypy:3 bash -c \
              "pypy3 setup.py install && \
              pypicontents pypi -o data/0-9/pypi.json -f logs/0-9/pypi.log -R 0-9"
          docker run -v ${PWD}:${PWD} -w ${PWD} \
              pypy:3 bash -c \
              "pypy3 setup.py install && \
              pypicontents stdlib -o stdlib/pypy3/stdlib.json"
        else
          docker run -v ${PWD}:${PWD} -w ${PWD} \
              dockershelf/python:${TRAVIS_PYTHON_VERSION} bash -c \
              "python${TRAVIS_PYTHON_VERSION} setup.py install && \
              pypicontents pypi -o data/0-9/pypi.json -f logs/0-9/pypi.log -R 0-9"
          docker run -v ${PWD}:${PWD} -w ${PWD} \
              dockershelf/python:${TRAVIS_PYTHON_VERSION} bash -c \
              "python${TRAVIS_PYTHON_VERSION} setup.py install && \
              pypicontents stdlib -o stdlib/${TRAVIS_PYTHON_VERSION}/stdlib.json"
        fi

after_success:
    - coveralls
